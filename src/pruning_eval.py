# -*- coding: utf-8 -*-
"""Pruning_eval.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Ma438JEEW08CMDjnE1q8RicG-W2y4lUf
"""

from imports import *
from global import prune_amounts, device
from utils import clone_and_prune

drop_acc = []

for amt in prune_amounts:
    if amt == 0.0:
        acc = 100 * correct / total
    else:
        pruned = clone_and_prune(model, amt)
        pruned.to(device)
        correct_p, total_p = 0, 0
        with torch.no_grad():
            for imgs, labels in dataloaders['val']:
                imgs, labels = imgs.to(device), labels.to(device)
                preds = pruned(imgs).argmax(dim=1)
                total_p += labels.size(0)
                correct_p += (preds == labels).sum().item()
        acc = 100 * correct_p / total_p
    drop_acc.append(acc)
    print(f"Prune {int(amt*100)}% â†’ Val Acc: {acc:.2f}%")

plt.figure()
plt.plot(prune_amounts, drop_acc, marker='o')
plt.title('Prune Amount vs Validation Accuracy')
plt.xlabel('Prune Amount')
plt.ylabel('Accuracy (%)')
plt.grid(True)
plt.show()